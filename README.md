# ğŸ›¢ï¸ Barrel Craft

A powerful CLI tool for generating clean and consistent barrel files (`index.ts` and `index.tsx`) for your TypeScript and React projects.

## ğŸš€ What is Barrel Craft?

Barrel Craft automates the creation of barrel files (index exports) that help organize and simplify imports in TypeScript and React projects. Instead of importing files individually from deep nested paths, barrel files allow you to import multiple modules from a single entry point.

**Before:**

```typescript
import { UserService } from "./services/user/UserService";
import { AuthService } from "./services/auth/AuthService";
import { Button } from "./components/ui/Button";
import { Modal } from "./components/ui/Modal";
```

**After:**

```typescript
import { UserService, AuthService } from "./services";
import { Button, Modal } from "./components/ui";
```

## âœ¨ Features

- ğŸ” **Smart Discovery**: Automatically finds and processes TypeScript/React files
- ğŸ“ **Flexible Configuration**: Support for config files with advanced patterns
- ğŸ¯ **Pattern Matching**: Exclude test files, specs, and other unwanted files
- ğŸ“± **Extension Smart**: Automatically uses `.tsx` when JSX files are present
- ğŸŒ³ **Subdirectory Support**: Process nested directories recursively
- ğŸ”§ **Force Generation**: Create barrels even for empty directories with valid subdirectories
- ğŸ”‡ **Quiet Mode**: Clean, minimal output by default with optional verbose mode
- âœ… **Safe**: Never overwrites existing `index.tsx` when generating `index.ts`

## ğŸ“¦ Installation

### Global Installation (Recommended)

```bash
npm install -g barrel-craft
```

### Local Installation

```bash
npm install --save-dev barrel-craft
```

## ğŸ¯ Usage

### Quick Start

```bash
# Generate barrel for current directory
barrel-craft
# or use shorter aliases:
barrel
craft

# Generate barrel for specific directory
barrel-craft ./src/components

# Include subdirectories (or use config file with subdirectories: true)
barrel-craft ./src --subdirectories

# Show detailed output
barrel-craft ./src -V
# or
barrel-craft ./src --verbose
```

### Configuration File

Create a configuration file for advanced usage:

```bash
barrel-craft init
```

This creates a `barrel-craft.json` file:

```json
{
  "headerComment": "// Auto-generated by barrel-craft\n\n",
  "targets": ["src"],
  "forceGenerate": [],
  "exclude": ["**/*.test.*", "**/*.spec.*", "**/*.d.ts"],
  "extensions": ["ts", "tsx"],
  "sortExports": true,
  "subdirectories": true,
  "verbose": false,
  "force": false
}
```

### CLI Options

```bash
barrel-craft [directory] [options]

Options:
  -v, --version                     Output the version number
  -e, --extensions <extensions...>  File extensions to include (default: ["ts","tsx"])
  -x, --exclude <patterns...>       Patterns to exclude (default: ["*.test.*","*.spec.*"])
  -s, --subdirectories              Include subdirectories (default: false)
  -c, --config <path>               Path to config file
  --header <comment>                Custom header comment for generated files
  --no-sort                         Do not sort exports alphabetically
  -V, --verbose                     Show detailed output (default: false)
  -h, --help                        Display help for command

Commands:
  init [options]                    Create a barrel-craft.json configuration file
  clean [options]                   Clean old barrel files with matching header comments
```

### Configuration File Options

| Option           | Type     | Default                                       | Description                          |
| ---------------- | -------- | --------------------------------------------- | ------------------------------------ |
| `headerComment`  | string   | `"// Auto-generated by barrel-craft\n\n"`     | Header comment for generated files   |
| `targets`        | string[] | `["src"]`                                     | Directories to process (normal mode) |
| `forceGenerate`  | string[] | `[]`                                          | Directories for forced generation    |
| `exclude`        | string[] | `["**/*.test.*", "**/*.spec.*", "**/*.d.ts"]` | Patterns to exclude                  |
| `extensions`     | string[] | `["ts", "tsx"]`                               | File extensions to process           |
| `sortExports`    | boolean  | `true`                                        | Whether to sort export statements    |
| `subdirectories` | boolean  | `true`                                        | Whether to process subdirectories    |
| `verbose`        | boolean  | `false`                                       | Show detailed output for each file   |
| `force`          | boolean  | `false`                                       | Clean all index files (clean command only) |

### Subdirectories Processing

The `subdirectories` option controls whether barrel-craft processes nested directories:

- **`subdirectories: true`** (default): Processes all subdirectories recursively
- **`subdirectories: false`**: Only processes the target directory

**CLI vs Config File:**

- CLI flag: `--subdirectories` overrides config file setting
- Config file: `"subdirectories": true` behaves the same as `--subdirectories` flag
- Default behavior: When using `init` command, `subdirectories` is set to `true` by default

**Example:**

```bash
# These are equivalent when config has "subdirectories": true
barrel-craft ./src
barrel-craft ./src --subdirectories
```

### Verbose Output

The `verbose` option controls the level of detail in the output:

- **`verbose: false`** (default): Shows only a summary count
- **`verbose: true`**: Shows detailed information for each generated file

**Output Examples:**

**Default (verbose=false):**

```bash
âœ… Generated 10 barrel file(s)
```

**Verbose (verbose=true):**

```bash
   /path/to/src/components/index.ts (5 exports) [normal]
   /path/to/src/services/index.ts (3 exports) [normal]
   /path/to/src/utils/index.ts (2 exports) [normal]

âœ… Generated 10 barrel file(s)
```

**CLI vs Config File:**

- CLI flag: `-V, --verbose` overrides config file setting
- Config file: `"verbose": true` shows detailed output
- Default behavior: `verbose` is set to `false` for cleaner output in large projects

### Variable Patterns

The configuration supports variable patterns for flexible path matching:

```json
{
  "targets": ["src/{components|utils}"],
  "forceGenerate": ["src/{auth|dashboard}/pages"]
}
```

This expands to:

- `targets`: `["src/components", "src/utils"]`
- `forceGenerate`: `["src/auth/pages", "src/dashboard/pages"]`

### Clean Command

The clean command helps remove old barrel files that may conflict with new ones:

```bash
# Preview what would be cleaned (recommended first step)
barrel-craft clean --dry-run

# Clean files with matching header comments only (safe)
barrel-craft clean

# Force clean all index.ts/tsx files (use with caution)
barrel-craft clean --force

# Clean with specific config file
barrel-craft clean -c my-config.json
```

**Clean Options:**

- `--dry-run`: Shows what files would be cleaned without actually deleting them
- `--force`: Removes all index.ts/tsx files regardless of header comments  
- `-c, --config <path>`: Use specific configuration file

**Safety Features:**

- **By default**: Only removes files with matching header comments to avoid deleting user-created index files
- **Header detection**: Automatically detects auto-generated files from previous tools or barrel-craft runs
- **Config support**: Supports `"force": true` in configuration file for automated cleaning

**Example with config file:**

```json
{
  "headerComment": "// Auto-generated by barrel-craft\n\n",
  "targets": ["src"],
  "force": true
}
```

```bash
barrel-craft clean  # Will use force: true from config
```

## ğŸ“‹ Examples

### Basic Usage

```bash
# Process current directory
barrel-craft

# Process specific directory with custom extensions
barrel-craft ./src --extensions js jsx

# Exclude additional patterns
barrel-craft ./src --exclude "*.test.*" "*.stories.*" "*.d.ts"
```

### With Configuration File

Create `barrel-craft.json`:

```json
{
  "headerComment": "// ğŸ›¢ï¸ Auto-generated barrel file\n// Do not edit manually\n\n",
  "targets": ["src/components", "src/services"],
  "forceGenerate": ["src/{pages|layouts}"],
  "exclude": ["**/*.test.*", "**/*.spec.*", "**/*.stories.*"],
  "extensions": ["ts", "tsx"],
  "sortExports": true,
  "subdirectories": true,
  "verbose": false,
  "force": false
}
```

Then run:

```bash
barrel-craft
```

### Force Generation Mode

Force generation creates barrels recursively, even for directories that would normally be skipped:

```json
{
  "forceGenerate": ["src/pages"]
}
```

This will create barrels for all subdirectories under `src/pages`, including empty directories that contain other directories with valid files.

## ğŸ”§ Generated Output Examples

### TypeScript Files Only

```typescript
// Auto-generated by barrel-craft

export * from "./AuthService";
export * from "./UserService";
export * from "./ValidationService";
```

### Mixed TypeScript and React Files

```typescript
// Auto-generated by barrel-craft

export * from "./Button";
export * from "./Modal";
export * from "./UserCard";
```

### With Subdirectories

```typescript
// Auto-generated by barrel-craft

export * from "./auth";
export * from "./components";
export * from "./UserService";
export * from "./ValidationService";
```

## ğŸ¤ Contributing

We welcome contributions! Here's how you can help:

### Development Setup

1. **Clone the repository**

```bash
git clone https://github.com/marcioaltoe/barrel-craft.git
cd barrel-craft
```

2. **Install dependencies**

```bash
bun install
```

3. **Development commands**

```bash
bun run dev          # Development mode with file watching
bun run test         # Run tests
bun run test:watch   # Run tests in watch mode
bun run test:ui      # Run tests with UI interface
bun run build        # Build for distribution
bun run lint         # Lint and auto-fix
bun run format       # Format code
```

### Project Structure

```
src/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ barrel-generator.ts    # Main barrel generation logic
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ config-loader.ts       # Configuration file handling
â”‚   â””â”€â”€ pattern-expander.ts    # Variable pattern expansion
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts              # TypeScript interfaces
â”œâ”€â”€ cli.ts                    # CLI entry point
â””â”€â”€ index.ts                  # Library exports

tests/
â”œâ”€â”€ barrel-generator.test.ts
â”œâ”€â”€ config-loader.test.ts
â””â”€â”€ pattern-expander.test.ts
```

### Guidelines

- **Code Quality**: All code must pass linting (`bun run lint`) and formatting (`bun run format`)
- **Testing**: Write tests for new features and maintain 100% test coverage
- **TypeScript**: Use strict TypeScript with proper typing
- **Commits**: Use conventional commit messages
- **Documentation**: Update README and JSDoc comments for new features

### Running Tests

```bash
# Run all tests
bun test

# Run specific test file
bun test tests/barrel-generator.test.ts

# Run tests with coverage
bun test --coverage
```

### Submitting Changes

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make your changes
4. Add tests for your changes
5. Ensure all tests pass (`bun test`)
6. Commit your changes (`git commit -m 'feat: add amazing feature'`)
7. Push to the branch (`git push origin feature/amazing-feature`)
8. Open a Pull Request

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- Built with [Commander.js](https://github.com/tj/commander.js) for CLI functionality
- Uses [glob](https://github.com/isaacs/node-glob) for file pattern matching
- Developed with [Bun](https://bun.sh) for fast development experience
- Tested with [Vitest](https://vitest.dev) for reliable testing

---

<div align="center">

**[ğŸ  Home](https://github.com/marcioaltoe/barrel-craft)** â€¢
**[ğŸ“š Documentation](https://github.com/marcioaltoe/barrel-craft/wiki)** â€¢
**[ğŸ› Issues](https://github.com/marcioaltoe/barrel-craft/issues)** â€¢
**[ğŸ’¡ Discussions](https://github.com/marcioaltoe/barrel-craft/discussions)**

</div>
