# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

barrel-craft is a npm CLI package for generating clean and consistent barrel files (`index.ts` and `index.tsx`) for TypeScript and React projects. This tool will be published to npm and used across multiple projects.

## Project Status

✅ **READY FOR PUBLISHING** - Complete implementation with comprehensive testing, documentation, and npm publishing setup.

## Architecture

NPM CLI package structure:

- CLI tool built with TypeScript
- **Runtime**: Node.js (for maximum compatibility)
- **Development**: Bun as package manager and dev runtime (faster development)
- **Linting & Formatting**: Biome.js + Prettier
- **Testing**: Vitest with coverage
- **Build**: TypeScript compilation to CommonJS
- Cross-platform compatibility

## Development Commands

**Daily Development:**

- `bun install` - Install dependencies
- `bun run dev` - Development mode with file watching
- `bun run test` - Run tests
- `bun run test:watch` - Run tests in watch mode

**Code Quality:**

- `bun run format` - Format all code (Biome + Prettier for MD/package.json)
- `bun run format:md` - Format only Markdown files
- `bun run format:pkg` - Format package.json
- `bun run lint` - Lint and auto-fix with Biome
- `bun run lint:fix` - Lint with unsafe fixes
- `bun run typecheck` - TypeScript type checking

**Build & Release:**

- `bun run build` - Build for distribution
- `bun run clean` - Clean dist folder
- `bun run compile` - TypeScript compilation only
- `bun run prepublishOnly` - Pre-publish validation (build + test + lint)
- `npm publish` - Publish to npm registry

**Testing:**

- `bun run test:ui` - Run tests with UI interface

## Project Structure

```
src/
├── core/
│   └── barrel-generator.ts   # Unified barrel generation logic with config support
├── utils/
│   ├── config-loader.ts      # Config file discovery and loading
│   └── pattern-expander.ts   # Variable pattern expansion utility
├── types/
│   └── index.ts              # TypeScript interfaces
├── cli.ts                    # CLI entry point
└── index.ts                  # Library exports

tests/
├── barrel-generator.test.ts  # Comprehensive generator tests (24 tests)
├── config-loader.test.ts     # Config loading tests
└── pattern-expander.test.ts  # Pattern expansion tests

dist/                         # Build output (git ignored)
├── cli.js                    # CLI executable
└── *.js + *.d.ts            # Compiled library

barrel-craft.example.json     # Example configuration file
```

## Package Configuration

**NPM Package Setup (✅ Completed):**

- `package.json` with proper `bin` field (`barrel-craft` → `dist/cli.js`)
- TypeScript compilation to CommonJS for Node.js compatibility
- CLI entry point with Node.js shebang (`#!/usr/bin/env node`)
- Dependencies: `commander`, `glob`
- DevDependencies: `@biomejs/biome`, `vitest`, `prettier`, etc.
- Target Node.js >=18.0.0

**Publishing Workflow (✅ Ready):**

- `prepublishOnly` script runs: build + test + lint
- Only `dist/` folder included in published package
- Automated quality checks prevent bad publishes

## CLI Usage

### **Unified CLI with Config File Support**

```bash
# Basic usage
barrel-craft                    # Generate barrel in current directory (auto-detects config)
barrel-craft ./src/components   # Generate barrel in specific directory

# Options
barrel-craft -e ts tsx js       # Custom extensions
barrel-craft -x "*.test.*"      # Custom exclude patterns
barrel-craft -s                 # Include subdirectories
barrel-craft --no-sort          # Don't sort exports
barrel-craft -c config.json     # Specify config file
barrel-craft --header "// Custom header"  # Custom header comment

# Initialize config file
barrel-craft init               # Create barrel-craft.json configuration file
barrel-craft init --force       # Overwrite existing config

# Config file example (barrel-craft.json):
{
  "headerComment": "// Auto-generated by barrel-craft\n\n",
  "targets": ["src", "lib"],
  "forceGenerate": [
    "src/components/{ui|composite}",
    "src/{auth|dashboard}/pages"
  ],
  "exclude": ["**/*.test.*", "**/*.d.ts"],
  "extensions": ["ts", "tsx"],
  "sortExports": true
}
```

## Implementation Notes

### Architecture

The project follows Clean Architecture principles with clear separation of concerns:

- **CLI Layer** (`src/cli.ts`): Command-line interface using Commander.js
- **Core Logic** (`src/core/barrel-generator.ts`): Unified barrel generator implementation
- **Utilities** (`src/utils/`): Helper functions and configuration management
  - `config-loader.ts`: Config file discovery and loading
  - `pattern-expander.ts`: Variable pattern expansion utility
- **Types** (`src/types/`): TypeScript interfaces and type definitions

### Key Features

#### Unified Implementation

- **CLI-based barrel generation** with full configuration support
- **Support for TypeScript and React files** (.ts, .tsx)
- **Subdirectory processing** with recursive capabilities
- **Export sorting and filtering** with customizable patterns
- **Pattern-based exclusion** (test files, specs, d.ts files)

#### Configuration System

- **Config File Auto-discovery**: Traverses up directory tree looking for:
  - `barrel-craft.json`
  - `.barrel-craft.json`
  - `barrel.config.json`
  - `.barrel.config.json`
- **Variable Pattern Expansion**: Supports patterns like `{option1|option2}`
  - Example: `src/{components|utils}` → `["src/components", "src/utils"]`
- **Force Generation Mode**: Processes directories recursively, creating barrels even for empty directories
- **Smart Barrel Detection**: Avoids overwriting `index.tsx` files when generating `index.ts`
- **Init Command**: Creates configuration files with overwrite protection

### Configuration Interface

The system supports both CLI options and file-based configuration:

```typescript
interface FileConfig {
  headerComment?: string; // Custom header for generated files
  targets: string[]; // Directories to process (normal mode)
  forceGenerate: string[]; // Directories for forced generation
  exclude: string[]; // Patterns to exclude
  extensions: string[]; // File extensions to process
  sortExports: boolean; // Whether to sort export statements
}
```

### Processing Modes

1. **Normal Mode**: Only generates barrels if content exists
2. **Forced Mode**: Generates barrels recursively, including for empty directories with valid subdirectories

### Pattern Expansion

The pattern expander handles complex scenarios:

- Single patterns: `{auth|dashboard}` → `["auth", "dashboard"]`
- Multiple patterns: `apps/{front|nexus}/src/{auth|dashboard}` → 4 combinations
- Nested expansion: Processes patterns recursively for multiple variables

### Testing Strategy

- **Comprehensive Unit Tests**: 24 tests covering all functionality
  - Core barrel generation logic
  - Configuration file loading and discovery
  - Variable pattern expansion utilities
- **Integration Tests**: End-to-end CLI behavior testing
- **File System Mocking**: Using Vitest for isolated testing
- **100% Test Coverage**: All major code paths and edge cases covered

### Development Standards

- Uses `node:` import protocol for Node.js modules
- Template literals preferred over string concatenation
- Type-only imports where appropriate
- Comprehensive test coverage with Vitest
- Layered architecture with clear separation of concerns

## Publishing Status

### ✅ **Ready for NPM Publication**

**Package Details:**

- **Name**: `barrel-craft` (verified available on npm)
- **Version**: 0.1.0
- **CLI Command**: `barrel-craft`
- **Repository**: https://github.com/marcioaltoe/barrel-craft

**Pre-publication Checklist Completed:**

- ✅ TypeScript compilation (CommonJS target)
- ✅ All tests passing (24/24)
- ✅ Linting and formatting clean
- ✅ Package structure validated with `npm pack`
- ✅ Documentation complete (README.md, LICENSE)
- ✅ Repository renamed and URLs updated
- ✅ `.npmignore` configured for clean publishing

**Publishing Commands:**

```bash
npm login              # If needed
npm publish           # Publish to npm registry

# Alternative test installation:
npm pack              # Generate .tgz for testing
npm install -g ./barrel-craft-0.1.0.tgz
```

**Post-publication:**

```bash
# Global installation
npm install -g barrel-craft

# Usage
barrel-craft --help
barrel-craft init
barrel-craft ./src/components
```
